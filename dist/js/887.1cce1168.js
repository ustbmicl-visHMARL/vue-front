"use strict";(self["webpackChunkvue_library"]=self["webpackChunkvue_library"]||[]).push([[887],{4887:function(e,t,r){r.r(t),r.d(t,{default:function(){return p}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"myinfo maxWH"},[e._m(0),t("main",{staticClass:"main"},[t("el-row",{staticClass:"tab"},[t("el-col",{attrs:{span:6}},[t("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"0"}},[t("el-menu-item",{attrs:{index:"0"},nativeOn:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.showInfo.apply(null,arguments)}}},[e._v("基础信息")]),t("el-menu-item",{attrs:{index:"1"},nativeOn:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.showPwd.apply(null,arguments)}}},[e._v("修改密码")])],1)],1),t("el-col",{staticClass:"content",attrs:{span:12}},[t("el-form",{directives:[{name:"show",rawName:"v-show",value:e.info_path,expression:"info_path"}],ref:"frontMyInfoForm",attrs:{model:e.frontMyInfoForm,"label-width":"80px",rules:e.rules,"hide-required-asterisk":""}},[t("el-form-item",{attrs:{label:"账号"}},[t("el-input",{attrs:{disabled:""},model:{value:e.userinfo.account,callback:function(t){e.$set(e.userinfo,"account","string"===typeof t?t.trim():t)},expression:"userinfo.account"}})],1),t("el-form-item",{attrs:{label:"用户名"}},[t("el-input",{attrs:{disabled:""},model:{value:e.userinfo.username,callback:function(t){e.$set(e.userinfo,"username","string"===typeof t?t.trim():t)},expression:"userinfo.username"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{model:{value:e.frontMyInfoForm.email,callback:function(t){e.$set(e.frontMyInfoForm,"email","string"===typeof t?t.trim():t)},expression:"frontMyInfoForm.email"}})],1),t("el-form-item",{attrs:{align:"center"}},[t("el-button",{staticStyle:{"margin-left":"-40px"},attrs:{type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.setEmail("frontMyInfoForm")}}},[e._v("提 交")]),t("el-button",{nativeOn:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.resetForm("frontMyInfoForm")}}},[e._v("重 置")])],1)],1),t("el-form",{directives:[{name:"show",rawName:"v-show",value:e.pwd_path,expression:"pwd_path"}],ref:"frontPwdForm",attrs:{model:e.pwdForm,rules:e.pwdRules,align:"center","label-width":"80px","label-position":"right","hide-required-asterisk":""}},[t("el-form-item",{attrs:{label:"旧密码",prop:"oldpwd"}},[t("el-input",{attrs:{type:"password"},model:{value:e.pwdForm.oldpwd,callback:function(t){e.$set(e.pwdForm,"oldpwd","string"===typeof t?t.trim():t)},expression:"pwdForm.oldpwd"}})],1),t("el-form-item",{attrs:{label:"新密码",prop:"newpwd"}},[t("el-input",{attrs:{type:"password"},model:{value:e.pwdForm.newpwd,callback:function(t){e.$set(e.pwdForm,"newpwd","string"===typeof t?t.trim():t)},expression:"pwdForm.newpwd"}})],1),t("el-form-item",{attrs:{label:"确认密码",prop:"newpwd1"}},[t("el-input",{attrs:{type:"password"},model:{value:e.pwdForm.newpwd1,callback:function(t){e.$set(e.pwdForm,"newpwd1","string"===typeof t?t.trim():t)},expression:"pwdForm.newpwd1"}})],1),t("el-form-item",{attrs:{align:"center"}},[t("el-button",{staticStyle:{"margin-left":"-40px"},attrs:{type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.updatePwd("frontPwdForm")}}},[e._v("修 改")]),t("el-button",{nativeOn:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.resetForm("frontPwdForm")}}},[e._v("重 置")])],1)],1)],1)],1)],1)])},n=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header flex"},[t("span",{staticClass:"title"},[e._v("个人信息")]),t("p",{staticClass:"info flex"},[e._v("查看/修改账户的基本信息")])])}],i=(r(7658),r(3822)),a={name:"MyInfo",data(){const e=(e,t,r)=>{const s=/^[a-zA-Z0-9_]{8,12}$/;t.trim().length<=0?r(new Error("请输入旧密码")):s.test(t.trim())?r():r(new Error("密码格式错误"))},t=(e,t,r)=>{const s=/^[a-zA-Z0-9_]{8,12}$/;t.trim().length<=0?r(new Error("请输入新密码")):s.test(t.trim())?t.trim()===this.pwdForm.oldpwd?r(new Error("新密码不能与旧密码相同")):r():r(new Error("密码格式错误"))},r=(e,t,r)=>{""===this.pwdForm.newpwd.trim()?r(new Error("请先输入新密码")):t.trim().length<=0?r(new Error("确认密码不得为空")):t.trim()!==this.pwdForm.newpwd?r(new Error("两次输入密码不一致")):r()};return{frontMyInfoForm:{email:""},pwdForm:{oldpwd:"",newpwd:"",newpwd1:""},pwdRules:{oldpwd:[{required:!0,trigger:["blur","change"],validator:e}],newpwd:[{required:!0,trigger:["blur","change"],validator:t}],newpwd1:[{required:!0,trigger:["blur","change"],validator:r}]},rules:{email:[{type:"email",required:!0,trigger:"blur",message:"邮箱格式不正确"}]},info_path:!0,pwd_path:!1}},computed:{...(0,i.Se)(["userinfo"])},mounted(){this.getUserEmail()},methods:{async getUserInfo(e){try{await this.$store.dispatch("getUserInfo",{user_id:e})}catch(t){console.warn(t.message)}},getUserEmail(){"未绑定邮箱"===this.userinfo.email?this.frontMyInfoForm.email="":this.frontMyInfoForm.email=this.userinfo.email},resetForm(e){this.$refs[e].resetFields()},showInfo(){this.info_path=!0,this.pwd_path=!1,this.resetForm("frontMyInfoForm"),this.resetForm("frontPwdForm"),this.getUserEmail()},showPwd(){this.info_path=!1,this.pwd_path=!0,this.resetForm("frontMyInfoForm"),this.resetForm("frontPwdForm"),this.getUserEmail()},async updatePwd(e){await this.$refs[e].validate((async t=>{t&&await this.$confirm("确定修改?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{const t={user_id:this.userinfo.user_id,oldpwd:this.pwdForm.oldpwd,newpwd:this.pwdForm.newpwd};await this.$store.dispatch("updatePwd",JSON.stringify(t)).then((t=>{this.$message({type:"success",message:t}),this.resetForm(e),setTimeout((()=>{this.$store.dispatch("userLogout").then((e=>this.$router.push("/login")))}),1e3)})).catch((e=>this.$message({type:"warning",message:e.message})))}catch(t){this.$message({type:"warning",message:t.message})}})).catch((()=>{this.$message({type:"info",message:"已取消"})}))}))},async setEmail(e){await this.$refs[e].validate((async e=>{e&&await this.$confirm("确定提交?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{const e={user_id:this.userinfo.user_id,email:this.frontMyInfoForm.email};await this.$store.dispatch("setEmail",JSON.stringify(e)).then((e=>{this.$message({type:"success",message:e}),this.getUserInfo(this.userinfo.user_id)})).catch((e=>this.$message({type:"warning",message:e.message})))}catch(e){this.$message({type:"warning",message:e.message})}})).catch((()=>{this.$message({type:"info",message:"已取消"})}))}))}}},o=a,l=r(1001),m=(0,l.Z)(o,s,n,!1,null,"5a3e507a",null),p=m.exports}}]);
//# sourceMappingURL=887.1cce1168.js.map