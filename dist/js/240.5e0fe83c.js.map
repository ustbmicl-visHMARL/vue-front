{"version":3,"file":"js/240.5e0fe83c.js","mappings":"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","sources":["webpack://vue-library/./src/views/Index/Front/Notice/index.vue","webpack://vue-library/./src/utils/friendlyDate.js","webpack://vue-library/src/views/Index/Front/Notice/index.vue","webpack://vue-library/./src/views/Index/Front/Notice/index.vue?ecb1","webpack://vue-library/./src/views/Index/Front/Notice/index.vue?8b3f"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"notice maxWH\"},[_vm._m(0),_c('main',{staticClass:\"main\"},[_c('div',{staticClass:\"read flex-center\"},[_c('el-button',{attrs:{\"type\":\"text\",\"disabled\":(_vm.readlist.length < 1)},nativeOn:{\"click\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.setAllRead.apply(null, arguments)}}},[_vm._v(\"全部已读\")])],1),_c('el-table',{staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.front_notice_list,\"height\":\"350\"}},[_c('el-table-column',{attrs:{\"prop\":\"notice_title\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return _c('span',{staticStyle:{\"position\":\"relative\"}},[_c('p',[_vm._v(_vm._s(scope.row.notice_title))]),_c('span',[_vm._v(_vm._s(_vm.friendlyDate(scope.row.create_time)))]),((scope.row.is_read === '未读'))?_c('i',{staticClass:\"el-icon-warning\",staticStyle:{\"position\":\"absolute\",\"top\":\"60%\",\"transform\":\"translateY(-50%)\",\"color\":\"tomato\"}}):_vm._e()])}}])}),_c('el-table-column',{attrs:{\"header-align\":\"center\",\"align\":\"right\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('div',{staticClass:\"handler\"},[_c('el-button',{attrs:{\"type\":\"info\",\"round\":\"\"},nativeOn:{\"click\":function($event){$event.preventDefault();return _vm.showNoticeDetail(scope.$index, _vm.front_notice_list)}}},[_vm._v(\" 查看 \")])],1)]}}])})],1)],1)])\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"header flex\"},[_c('span',{staticClass:\"title\"},[_vm._v(\"消息通知\")])])\n}]\n\nexport { render, staticRenderFns }","function friendlyDate(timestamp) {\r\n    timestamp = new Date(timestamp)\r\n\tlet formats = {\r\n\t\t'year': '%n% 年前',\r\n\t\t'month': '%n% 月前',\r\n\t\t'day': '%n% 天前',\r\n\t\t'hour': '%n% 小时前',\r\n\t\t'minute': '%n% 分钟前',\r\n\t\t'second': '%n% 秒前',\r\n\t}\r\n\r\n\tlet now = Date.now();\r\n\tlet seconds = Math.floor((now - timestamp) / 1000)\r\n\tlet minutes = Math.floor(seconds / 60)\r\n\tlet hours = Math.floor(minutes / 60)\r\n\tlet days = Math.floor(hours / 24)\r\n\tlet months = Math.floor(days / 30)\r\n\tlet years = Math.floor(months / 12)\r\n\r\n\tlet diffType = ''\r\n\tlet diffValue = 0;\r\n\tif (years > 0) {\r\n\t\tdiffType = 'year'\r\n\t\tdiffValue = years\r\n\t} else {\r\n\t\tif (months > 0) {\r\n\t\t\tdiffType = 'month'\r\n\t\t\tdiffValue = months\r\n\t\t} else {\r\n\t\t\tif (days > 0) {\r\n\t\t\t\tdiffType = 'day'\r\n\t\t\t\tdiffValue = days\r\n\t\t\t} else {\r\n\t\t\t\tif (hours > 0) {\r\n\t\t\t\t\tdiffType = 'hour'\r\n\t\t\t\t\tdiffValue = hours\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (minutes > 0) {\r\n\t\t\t\t\t\tdiffType = 'minute'\r\n\t\t\t\t\t\tdiffValue = minutes\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdiffType = 'second'\r\n\t\t\t\t\t\tdiffValue = seconds === 0 ? (seconds = 1) : seconds\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn formats[diffType].replace('%n%', diffValue)\r\n}\r\n\r\nexport default friendlyDate","<template>\r\n    <div class=\"notice maxWH\">\r\n        <!-- 头部 -->\r\n        <div class=\"header flex\">\r\n            <span class=\"title\">消息通知</span>\r\n        </div>\r\n        <!-- 主体 -->\r\n        <main class=\"main\">\r\n            <!-- 已读按钮 -->\r\n            <div class=\"read flex-center\">\r\n                <el-button\r\n                    type=\"text\"\r\n                    :disabled=\"(readlist.length < 1)\"\r\n                    @click.native.prevent.stop=\"setAllRead\">全部已读</el-button>\r\n            </div>\r\n            <!-- 显示通知 -->\r\n            <el-table :data=\"front_notice_list\" height=\"350\" style=\"width: 100%\">\r\n                <el-table-column prop=\"notice_title\">\r\n                    <span slot-scope=\"scope\" style=\"position: relative;\">\r\n                        <p>{{ scope.row.notice_title }}</p>\r\n                        <span>{{ friendlyDate(scope.row.create_time) }}</span>\r\n                        <i v-if=\"(scope.row.is_read === '未读')\" class=\"el-icon-warning\"\r\n                            style=\"position: absolute;top: 60%;transform: translateY(-50%);color: tomato;\"></i>\r\n                    </span>\r\n                </el-table-column>\r\n                <el-table-column header-align=\"center\" align=\"right\">\r\n                    <template slot-scope=\"scope\">\r\n                        <div class=\"handler\">\r\n                            <el-button @click.native.prevent=\"showNoticeDetail(scope.$index, front_notice_list)\"\r\n                                type=\"info\" round>\r\n                                查看\r\n                            </el-button>\r\n                        </div>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n        </main>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters } from 'vuex'\r\nimport friendlyDate from '@/utils/friendlyDate'\r\nexport default {\r\n    name: 'Notice',\r\n    data() {\r\n        return {\r\n            // 获取时间差\r\n            friendlyDate,\r\n        }\r\n    },\r\n    computed: {\r\n        ...mapGetters(['front_notice_list', 'readlist', 'userinfo'])\r\n    },\r\n    mounted() {\r\n        this.getNoticeList()\r\n    },\r\n    methods: {\r\n        // 获取用户信息\r\n        async getUserInfo(user_id) {\r\n            try {\r\n                await this.$store.dispatch('getUserInfo', { user_id })\r\n            } catch (e) {\r\n                console.warn(e.message)\r\n            }\r\n        },\r\n        // 获取通知列表\r\n        async getNoticeList() {\r\n            try {\r\n                await this.$store.dispatch('frontGetNoticeList', { user_id: this.userinfo.user_id })\r\n            } catch (e) {\r\n                this.$message({ type: 'warning', message: e.message })\r\n            }\r\n        },\r\n        // 查看详情\r\n        async showNoticeDetail(index, rows) {\r\n            const { notice_title, notice_detail, notice_id, is_read, user_id } = rows[index]\r\n            // console.log(rows[index])\r\n            await this.$alert(notice_detail, notice_title, {\r\n                confirmButtonText: '确定',\r\n                callback: async action => {\r\n                    if (is_read !== '已读') {\r\n                        // 设置阅读状态为已读\r\n                        await this.setRead(user_id, notice_id)\r\n                        // 重新获取用户信息\r\n                        await this.getUserInfo(user_id)\r\n                        // 重新获取通知列表\r\n                        await this.getNoticeList()\r\n                    }\r\n                    return 'ok'\r\n                }\r\n            })\r\n        },\r\n        // 设置通知状态为已读\r\n        async setRead(user_id, notice_id) {\r\n            try {\r\n                await this.$store.dispatch('frontSetRead', { user_id, notice_id })\r\n            } catch (e) {\r\n                console.warn(e.message)\r\n            }\r\n        },\r\n        // 全部已读\r\n        async setAllRead() {\r\n            try {\r\n                const user_id = this.userinfo.user_id\r\n                await this.$store.dispatch('frontAllSetRead', { user_id })\r\n                    .then(async res => {\r\n                        // 重新获取用户信息\r\n                        await this.getUserInfo(user_id)\r\n                        // 重新获取通知列表\r\n                        await this.getNoticeList()\r\n                        // \r\n                        this.$notify({ title: '成功', type: 'success', message: '已清空未读通知' })\r\n                    })\r\n            } catch (e) {\r\n                console.warn(e.message)\r\n            }\r\n        },\r\n    }\r\n\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.notice {\r\n    .header {\r\n        width: 100%;\r\n        height: 100px;\r\n        background-color: #324057;\r\n        box-sizing: border-box;\r\n        padding: 50px 20% 10px;\r\n        overflow: hidden;\r\n\r\n        .title {\r\n            font-size: 25px;\r\n            color: #fff;\r\n        }\r\n    }\r\n\r\n    .main {\r\n        width: 100%;\r\n        height: calc(100% - 100px);\r\n        box-sizing: border-box;\r\n        padding: 20px 20%;\r\n\r\n        .read {\r\n            width: 100%;\r\n            justify-content: flex-end;\r\n        }\r\n    }\r\n}\r\n</style>","import mod from \"-!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=415af1fa&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=415af1fa&prod&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"415af1fa\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","_m","attrs","readlist","length","nativeOn","$event","preventDefault","stopPropagation","setAllRead","apply","arguments","_v","staticStyle","front_notice_list","scopedSlots","_u","key","fn","scope","_s","row","notice_title","friendlyDate","create_time","is_read","_e","showNoticeDetail","$index","staticRenderFns","timestamp","Date","formats","now","seconds","Math","floor","minutes","hours","days","months","years","diffType","diffValue","replace","name","data","computed","mapGetters","mounted","getNoticeList","methods","user_id","$store","dispatch","e","console","warn","message","userinfo","$message","type","index","rows","notice_detail","notice_id","$alert","confirmButtonText","callback","setRead","getUserInfo","then","$notify","title","component"],"sourceRoot":""}